# ТЗ: Интерфейс и дизайн — Local Chat

---

## 1. Общая информация

| Параметр | Значение |
|----------|----------|
| Название приложения | Local Chat |
| Логотип | Текстовое название |
| Тема | Светлая (только) |
| UI-библиотека | Tailwind CSS + shadcn/ui |
| Адаптивность | Desktop (1024px+), Mobile (320px+) |
| Toast-уведомления | Нижний правый угол |
| Лоадер LLM | Три точки с анимацией |

---

## 2. Роли пользователей

| Роль | Доступ к интерфейсу |
|------|---------------------|
| **Пользователь** | Полный доступ ко всем страницам после авторизации |
| **Разработчик** | Нет интерфейса (управление через БД напрямую) |

---

## 3. Карта страниц

```
/login          — Страница входа (публичная)
/               — Главная страница / Новый чат (защищённая)
/chat/:id       — Страница чата (защищённая)
/profile        — Страница профиля (защищённая)
```

---

## 4. Описание страниц

---

### 4.1. Страница входа

**URL:** `/login`

**Доступ:** Публичная (неавторизованные пользователи)

**Purpose:**  
Позволяет пользователю войти в систему, используя логин и пароль.

---

**UI Components:**

**Header:**
- Текстовый логотип "Local Chat" (центрирован)

**Форма входа (центрирована на странице):**
- Заголовок: "Вход в систему"
- Поле ввода "Логин"
  - Тип: `text`
  - Placeholder: "Введите логин"
  - Валидация: обязательное поле
- Поле ввода "Пароль"
  - Тип: `password`
  - Placeholder: "Введите пароль"
  - Валидация: обязательное поле
  - Иконка "показать/скрыть пароль" (опционально)
- Кнопка "Войти"
  - Состояние `disabled`, пока оба поля не заполнены
  - Состояние `loading` во время запроса (спиннер внутри кнопки)
- Сообщение об ошибке (под формой)
  - Текст: "Неверный логин или пароль"
  - Цвет: красный
  - Скрыто по умолчанию

---

**On Submit:**
1. Отправка `POST /api/auth/login` с `{ username, password }`
2. При успехе:
   - Сохранение токена сессии (httpOnly cookie или localStorage)
   - Редирект на `/`
3. При ошибке:
   - Отображение сообщения "Неверный логин или пароль"
   - Поле пароля очищается

---

**Адаптивность:**
- Mobile: форма занимает 90% ширины экрана
- Desktop: форма фиксированной ширины (400px), центрирована

---

### 4.2. Главная страница / Новый чат

**URL:** `/`

**Доступ:** Только авторизованные пользователи

**Purpose:**  
Позволяет пользователю начать новый диалог с нейросетью и видеть историю своих чатов.

---

**UI Components:**

**Layout:**
```
┌─────────────────────────────────────────────────────┐
│ [Sidebar]              │       [Main Content]       │
│                        │                            │
│ - Logo                 │   Приветственный текст     │
│ - New Chat Button      │                            │
│ - Chat List            │   [Input Field]  [Send]    │
│ - Profile Button       │                            │
└─────────────────────────────────────────────────────┘
```

---

**Sidebar (боковое меню):**

- **Логотип "Local Chat"**
  - Расположение: верхняя часть sidebar
  - Клик → переход на `/`

- **Кнопка "Новый чат"**
  - Иконка: `+` (Plus)
  - Текст: "Новый чат"
  - Расположение: под логотипом
  - Клик → переход на `/` (если не там), очистка поля ввода

- **Список чатов**
  - Источник: `GET /api/chats` (динамический)
  - Сортировка: по `date_updated` DESC (новые сверху)
  - Каждый элемент:
    - Название чата ("Чат №X")
    - Дата последнего сообщения (относительная: "Сегодня", "Вчера", "12 дек")
    - При hover (desktop): иконка удаления (корзина)
    - Клик → переход на `/chat/:id`
  - Если чатов нет: текст "Чатов пока нет"
  - Скролл при большом количестве чатов

- **Кнопка профиля**
  - Расположение: нижняя часть sidebar
  - Отображает: имя пользователя (или "Пользователь" если не указано)
  - Иконка: `User` или инициалы
  - Клик → переход на `/profile`

---

**Main Content (центральная область):**

- **Приветственный текст**
  - Расположение: центр экрана (вертикально и горизонтально)
  - Заголовок: "Привет! Чем могу помочь?"
  - Подзаголовок: "Начните диалог, отправив сообщение ниже"

- **Информация о модели**
  - Текст: "Модель: qwen3:30b"
  - Расположение: над полем ввода или в углу
  - Стиль: мелкий серый текст (информационный, не кликабельный)

- **Поле ввода сообщения**
  - Расположение: нижняя часть экрана, фиксированное
  - Тип: `textarea` (многострочный)
  - Placeholder: "Напишите сообщение..."
  - Автоматическое увеличение высоты при вводе (до max-height)
  - Клавиши:
    - `Enter` → отправка
    - `Shift+Enter` → перенос строки

- **Кнопка отправки**
  - Иконка: `Send` (стрелка)
  - Расположение: справа от поля ввода
  - Состояние `disabled`: пока поле пустое

---

**On Action (отправка первого сообщения):**
1. `POST /api/chats` — создание нового чата
2. `POST /api/chats/:id/messages` — отправка сообщения
3. Редирект на `/chat/:id`
4. Отображение индикатора загрузки (три точки)
5. `POST` к n8n webhook — запрос к LLM
6. Сохранение ответа в БД
7. Отображение ответа

---

**Адаптивность (Mobile):**
- Sidebar скрыт по умолчанию
- Иконка "гамбургер" в верхнем левом углу
- При клике — sidebar выезжает поверх контента (overlay)
- Клик вне sidebar или на элемент — закрытие

---

### 4.3. Страница чата

**URL:** `/chat/:id`

**Доступ:** Только авторизованные пользователи, только владелец чата

**Purpose:**  
Позволяет пользователю вести диалог с нейросетью, просматривать историю сообщений и управлять чатом.

---

**UI Components:**

**Layout:** Аналогичен главной странице (Sidebar + Main Content)

---

**Sidebar:** Идентичен главной странице
- Активный чат визуально выделен (фоновый цвет)

---

**Main Content:**

- **Заголовок чата**
  - Текст: название чата ("Чат №X")
  - Расположение: верхняя часть main content
  - Фиксированный при скролле

- **Область сообщений**
  - Скроллируемая область
  - Автоскролл вниз при новых сообщениях
  - Источник: `GET /api/chats/:id/messages` (динамический)

- **Сообщение пользователя**
  - Расположение: справа
  - Фон: светло-синий/серый
  - Скругленные углы
  - Текст: plain text (без markdown)

- **Сообщение ассистента**
  - Расположение: слева
  - Фон: белый с границей или светло-серый
  - Контент: рендеринг Markdown
    - Заголовки (H1-H6)
    - Списки (маркированные, нумерованные)
    - Код inline (`code`)
    - Код block (```language) с подсветкой синтаксиса
    - Жирный, курсив
    - Ссылки
  - При hover: панель действий

- **Панель действий на сообщении ассистента**
  - Иконка "Копировать" 
    - Клик → копирование raw-текста в буфер
    - Показать toast "Скопировано"
  - Иконка "Регенерировать" (только на последнем сообщении)
    - Клик → повторный запрос к LLM

- **Индикатор загрузки (ожидание ответа)**
  - Расположение: слева (как сообщение ассистента)
  - Визуал: три анимированные точки
  - Появляется после отправки сообщения
  - Исчезает при получении ответа

- **Кнопка отмены**
  - Появляется вместо кнопки отправки во время ожидания
  - Иконка: `X` или `Stop`
  - Клик → отмена HTTP-запроса

- **Поле ввода сообщения**
  - Идентично главной странице
  - Состояние `disabled` во время ожидания ответа

- **Сообщение об ошибке (в чате)**
  - Расположение: слева (как сообщение ассистента)
  - Фон: светло-красный
  - Текст ошибки
  - Кнопка "Повторить"

---

**On Actions:**

**Отправка сообщения:**
1. Блокировка поля ввода и кнопки отправки
2. `POST /api/chats/:id/messages` с `{ content, role: 'user' }`
3. Отображение сообщения пользователя в чате
4. Отображение индикатора загрузки
5. `POST` к n8n webhook (timeout: 150 сек)
6. При успехе: сохранение ответа, отображение в чате
7. При ошибке: отображение сообщения об ошибке
8. Разблокировка поля ввода

**Копирование:**
1. `navigator.clipboard.writeText(rawContent)`
2. Toast "Скопировано"

**Регенерация:**
1. Удаление последнего сообщения ассистента из UI
2. Отображение индикатора загрузки
3. Повторный `POST` к n8n webhook с тем же контекстом
4. `PUT /api/messages/:id` — обновление сообщения в БД
5. Отображение нового ответа

**Отмена:**
1. `AbortController.abort()`
2. Скрытие индикатора загрузки
3. Сообщение пользователя остаётся в чате
4. Разблокировка поля ввода

---

**Адаптивность (Mobile):**
- Идентично главной странице
- Сообщения занимают ~85% ширины экрана

---

### 4.4. Страница профиля

**URL:** `/profile`

**Доступ:** Только авторизованные пользователи

**Purpose:**  
Позволяет пользователю просматривать и редактировать личные данные, а также выйти из системы.

---

**UI Components:**

**Layout:** Sidebar + Main Content (идентично другим страницам)

---

**Main Content:**

- **Заголовок страницы**
  - Текст: "Настройки профиля"

- **Форма редактирования**
  - Поле "Имя"
    - Тип: `text`
    - Placeholder: "Введите имя"
    - Значение: из БД (динамическое)
  - Поле "Фамилия"
    - Тип: `text`
    - Placeholder: "Введите фамилию"
    - Значение: из БД (динамическое)
  - Кнопка "Сохранить"
    - Состояние `disabled`: если данные не изменены
    - Состояние `loading`: во время сохранения

- **Информация об аккаунте (readonly)**
  - Логин: отображение username (не редактируется)

- **Кнопка "Выйти"**
  - Расположение: под формой, отделена визуально
  - Стиль: красный/outline (деструктивное действие)
  - Клик → выход из системы

---

**On Actions:**

**Сохранение профиля:**
1. `PUT /api/profile` с `{ first_name, last_name }`
2. Обновление данных в БД
3. Toast "Изменения сохранены"
4. Обновление имени в sidebar (если изменилось)

**Выход:**
1. `POST /api/auth/logout`
2. Удаление токена сессии
3. Редирект на `/login`

---

## 5. Общие компоненты

---

### 5.1. Toast-уведомления

**Расположение:** Нижний правый угол

**Типы:**
| Тип | Цвет | Иконка | Пример |
|-----|------|--------|--------|
| Success | Зелёный | ✓ | "Изменения сохранены", "Скопировано" |
| Error | Красный | ✕ | "Ошибка соединения", "Сервер недоступен" |
| Warning | Жёлтый | ⚠ | "Нейросеть обрабатывает другой запрос..." |
| Info | Синий | ℹ | "Сессия истекла" |

**Поведение:**
- Автоматическое исчезновение через 4 секунды
- Возможность закрыть вручную (иконка ×)
- Стэкинг при нескольких уведомлениях

---

### 5.2. Модальное окно подтверждения удаления

**Триггер:** Клик на иконку удаления чата в sidebar

**UI Components:**
- Overlay (затемнение фона)
- Модальное окно (центрировано)
  - Заголовок: "Удалить чат?"
  - Текст: "Чат и все сообщения будут удалены. Это действие необратимо."
  - Кнопка "Отмена" (secondary)
  - Кнопка "Удалить" (destructive, красная)

**On Actions:**
- "Отмена" → закрытие модального окна
- "Удалить" → `DELETE /api/chats/:id`, закрытие окна, обновление списка чатов
- Клик на overlay → закрытие модального окна
- `Escape` → закрытие модального окна

---

### 5.3. Sidebar (Mobile)

**Состояние по умолчанию:** Скрыт

**Открытие:**
- Иконка "гамбургер" (☰) в верхнем левом углу main content
- Sidebar выезжает слева (animation: slide-in)
- Overlay затемняет main content

**Закрытие:**
- Клик на overlay
- Клик на элемент чата (после перехода)
- Клик на иконку закрытия (×) в sidebar
- Свайп влево (опционально)

---

## 6. Состояния UI

---

### 6.1. Состояния кнопки отправки

| Состояние | Вид | Поведение |
|-----------|-----|-----------|
| Default | Иконка Send | Клик → отправка |
| Disabled | Иконка Send (серая) | Поле ввода пустое |
| Loading | Индикатор загрузки в чате, кнопка → "Отмена" | Ожидание ответа LLM |

---

### 6.2. Состояния страницы чата

| Состояние | Отображение |
|-----------|-------------|
| Загрузка истории | Skeleton-блоки или спиннер |
| Пустой чат | — (новый чат без сообщений) |
| С сообщениями | Список сообщений |
| Ожидание ответа | Сообщения + индикатор (три точки) |
| Ошибка | Сообщения + сообщение об ошибке с кнопкой "Повторить" |

---

### 6.3. Сообщения об ошибках

| Ситуация | Toast-сообщение | В чате |
|----------|-----------------|--------|
| Ошибка сети | "Ошибка соединения. Проверьте интернет" | Сообщение об ошибке + "Повторить" |
| Сервер недоступен (5xx) | "Сервер временно недоступен" | Сообщение об ошибке + "Повторить" |
| Ollama недоступна | "Нейросеть недоступна" | Сообщение об ошибке + "Повторить" |
| Таймаут (150 сек) | "Превышено время ожидания" | Сообщение об ошибке + "Повторить" |
| Очередь запросов | "Ваше сообщение в очереди..." | — (только toast) |
| Ошибка авторизации | "Сессия истекла" | Редирект на /login |

---

## 7. Цветовая схема (референс)

| Элемент | Цвет (Tailwind) |
|---------|-----------------|
| Фон страницы | `bg-gray-50` |
| Sidebar фон | `bg-white` |
| Sidebar граница | `border-gray-200` |
| Primary кнопка | `bg-blue-600` |
| Destructive кнопка | `bg-red-600` |
| Сообщение user | `bg-blue-100` |
| Сообщение assistant | `bg-white border border-gray-200` |
| Текст основной | `text-gray-900` |
| Текст secondary | `text-gray-500` |
| Ошибка | `text-red-600` |

---

## 8. Типографика

| Элемент | Стиль |
|---------|-------|
| Заголовок страницы | `text-xl font-semibold` |
| Название чата в sidebar | `text-sm font-medium` |
| Дата в sidebar | `text-xs text-gray-500` |
| Сообщение в чате | `text-base` |
| Код в сообщении | `font-mono text-sm` |
| Placeholder | `text-gray-400` |

---

## 9. Иконки (Lucide React)

| Действие | Иконка |
|----------|--------|
| Новый чат | `Plus` |
| Отправить | `Send` |
| Отмена | `X` |
| Удалить | `Trash2` |
| Копировать | `Copy` |
| Регенерировать | `RefreshCw` |
| Профиль | `User` |
| Меню (mobile) | `Menu` |
| Закрыть | `X` |
| Показать пароль | `Eye` |
| Скрыть пароль | `EyeOff` |

---
